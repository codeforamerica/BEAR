# README

B.E.A.R. (Bulk Expungement Analysis of Records)

This app provides a desktop GUI for a Golang script that takes in CA Department of Justice .dat files containing criminal histories and identifies convictions that are eligible for relief under CA Prop 64.
The app can be packaged for installation on Windows, Mac, or Linux.

The Golang project can be found [here](https://github.com/codeforamerica/gogen).

<p>
  This project uses <a href="http://electron.atom.io/">Electron</a>, <a href="https://facebook.github.io/react/">React</a>, <a href="http://webpack.github.io/docs/">Webpack</a> and <a href="https://github.com/gaearon/react-hot-loader">React Hot Loader</a> for rapid application development (HMR).
</p>

## Install

First, clone the repo via git:

```bash
$ git clone git@github.com:codeforamerica/bear.git
```

And then install the dependencies with yarn.

```bash
$ cd BEAR
$ yarn
```

## Starting Development

Start the app in the `dev` environment. This starts the renderer process in [**hot-module-replacement**](https://webpack.js.org/guides/hmr-react/) mode and starts a webpack dev server that sends hot updates to the renderer process:

```bash
$ yarn dev
```

## Testing

To run the unit tests:

```bash
$ yarn test
```

To run the end-to-end tests:

```bash
$ yarn build-e2e
$ yarn test-e2e
```

To run all tests including the linter and the Flow type-checker:

```bash
$ yarn test-all
```

To update the test snapshots when you have made intentional changes to the UI:

```bash
$ yarn test-update-snapshots
```

## Acquiring and Updating your Gogen Binary

In order to work in development mode, this application expects an executable binary at `~/go/bin/gogen`. This binary IS NOT INCLUDED IN THE COMMITTED FILES.
The binary is generated by a separate repo that can be found [here](https://github.com/codeforamerica/gogen).
To build the binary and place a copy where the development mode of BEAR expects it, follow the instructions for cloning and installing in the gogen README, then:

```
$ cd ~/go/src/gogen
$ go build
$ cp gogen ~/go/bin/gogen
```

You must repeat this process any time you make changes to the gogen code, if you want to see those changes reflected when running BEAR in development mode.
For information about how to include the gogen binary when packaging BEAR for production, see the next section.

## Packaging for Production

BEAR can be automatically packaged and published to Github as part of the CircleCI workflow. In this case, it will use the version of the gogen binary specified in `.gogen-version`, retrieved from [Github](https://github.com/codeforamerica/gogen/releases).

We recommend using the CI release process when possible, but if you need to package the app on your local machine, instructions can be found below.

We use [electron-builder](https://github.com/electron-userland/electron-builder) to package and publish the app.

To package the app for Mac:

```bash
$ yarn package-mac
```

To package the app for Windows:

```bash
$ yarn package-win
```

To package the app for Windows and automatically publish to Github (this should only be done as part of a successful CI build):

```bash
$ yarn package-publish-win
```

### Including the gogen binary in the packaged app

When packaging, BEAR expects a copy of the gogen binary to be present in the project root. Keep in mind that the binary must be of the correct type to match the platform you are packaging for.
For example, if you are packaging for Windows you need to make sure there is a gogen.exe binary in the BEAR project root.
It is fine if there are both Mac and Windows binaries in the project root at package time - the app will detect the platform and select the correct binary based on the file extension.
Remember that if your are packaging on your local machine, you need to update the binary manually if you want to capture changes made to gogen.

## Electron-React-Boilerplate

This project was built on top of [Electron React Boilerplate](https://github.com/electron-react-boilerplate)

See their [docs and guides here](https://electron-react-boilerplate.js.org/docs/installation)

## License

TBD
